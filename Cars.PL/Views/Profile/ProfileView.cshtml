@{
    ViewBag.Title = "Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="~/css/ProfileView.css" />
@model AppUser

<section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('/images/bg_3.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
            <div class="col-md-9 ftco-animate pb-5">
                <p class="breadcrumbs">
                    <span class="mr-2">
                        <a href="@Url.Action("Index", "Home")">@SharedLocalizer["Home"] <i class="ion-ios-arrow-forward"></i></a>
                    </span> 
                    <span>Profile <i class="ion-ios-arrow-forward"></i></span>
                </p>
                <h1 class="mb-3 bread">Profile Details</h1>
            </div>
        </div>
    </div>
</section>

<div class="container-fluid profile-container">
    
    <!-- Profile Image Section -->
    <div class="row justify-content-center mb-4">
        <div class="col-auto">
            <div class="profile-image-wrapper">
                <img src="@Url.Content("~/Files/" + Model.UserImagePath)" 
                     class="user-image" 
                     alt="Profile Picture"
                     onerror="this.src='~/images/default-avatar.png'" />
                <div class="image-overlay">
                    <i class="fas fa-camera"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Header Section with Action Buttons -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="profile-card">
                <div class="profile-header">
                    <h2 class="profile-title">
                        <i class="fas fa-user-circle"></i>
                        My Profile
                    </h2>
                    
                    <div class="action-buttons">
                        <!-- Edit Profile Button -->
                        <a href="@Url.Action("EditUserProfileView", "EditUserProfile")" class="btn btn-primary">
                            <i class="fas fa-edit"></i> 
                            <span class="btn-text">Edit Profile</span>
                        </a>
                        
                        <!-- Change Password Button -->
                        <a href="@Url.Action("VerifyEmail", "EditUserProfile")" class="btn btn-secondary">
                            <i class="fas fa-key"></i> 
                            <span class="btn-text">Change Password</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Information Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="profile-card">
                <h4 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    Personal Information
                </h4>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="info-item">
                            <label>Full Name</label>
                            <p>@Model.FullName</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="info-item">
                            <label>User Name</label>
                            <p>@Model.UserName</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="info-item">
                            <label>Email</label>
                            <p>@Model.Email</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="info-item">
                            <label>Phone Number</label>
                            <p>@(String.IsNullOrEmpty(Model.PhoneNumber) ? "Not provided" : Model.PhoneNumber)</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="info-item">
                            <label>Role</label>
                            <p>
                                <span class="role-badge @(User.IsInRole("User") ? "user-role" : "mechanic-role")">
                                    @if (User.IsInRole("User"))
                                    {
                                        <i class="fas fa-user">User</i> 
                                    }
                                    else
                                    {
                                        <i class="fas fa-tools">Mechanic</i> 
                                    }
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rent Cars Section (For Both Roles) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="profile-card">
                <h4 class="section-title">
                    <i class="fas fa-car"></i>
                    @(User.IsInRole("User") ? "My Rented Cars" : "Cars I'm Working On")
                </h4>
                
                @{
                    var paidRents = Model.Rents?.Where(r => r.Status == "Paid")?.ToList();
                    bool hasActiveCars = paidRents != null && paidRents.Any();
                }
                
                @if (hasActiveCars)
                {
                    <div class="row">
                        @foreach (var rent in paidRents)
                        {
                            <div class="col-xl-4 col-lg-6 col-md-6 mb-3">
                                <div class="car-card success-card">
                                    <div class="card-header">
                                        <i class="fas fa-car"></i>
                                        <h6>@rent.Car?.Brand @rent.Car?.Model @rent.Car?.Year</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="info-row">
                                            <strong>Start Date:</strong> 
                                            <span>@rent.StartDate.ToString("MMM dd, yyyy")</span>
                                        </div>
                                        <div class="info-row">
                                            <strong>End Date:</strong> 
                                            <span>@rent.EndDate.ToString("MMM dd, yyyy")</span>
                                        </div>
                                        <div class="info-row">
                                            <strong>Pick up location:</strong> 
                                            <span>@rent.Pick_up_location</span>
                                        </div>
                                        <div class="info-row">
                                            <strong>Drop Off location:</strong> 
                                            <span>@rent.Drop_Off_location</span>
                                        </div>
                                        <div class="info-row">
                                            <strong>Status:</strong> 
                                            <span class="status-badge success">@rent.Status</span>
                                        </div>
                                        <div class="info-row">
                                            <strong>Fine:</strong> 
                                            <span class="status-badge success">@rent.Fine</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-state">
                        <i class="fas fa-car"></i>
                        <p>@(User.IsInRole("User") ? "No rented cars found" : "No cars assigned for maintenance")</p>
                    </div>
                }
            </div>
        </div>
    </div>

    @if (User.IsInRole("User"))
    {
        <!-- Accidents Section (User Role Only) -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="profile-card">
                    <h4 class="section-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        My Accidents
                    </h4>
                    
                    @if (ViewBag.ACCIDENTS != null && ((IEnumerable<dynamic>)ViewBag.ACCIDENTS).Any())
                    {
                        <div class="row">
                            @foreach (var accident in (IEnumerable<dynamic>)ViewBag.ACCIDENTS)
                            {
                                <div class="col-xl-4 col-lg-6 col-md-6 mb-3">
                                    <div class="car-card danger-card">
                                        <div class="card-header">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <h6>Accident #@accident.AccidentId</h6>
                                        </div>
                                        <div class="info-row">
                                                <strong>Car:</strong> 
                                                <span>@accident.Car?.Brand @accident.Car?.Model @accident.Car?.Year</span>
                                        </div>
                                        <div class="card-body">
                                            <div class="info-row">
                                                <strong>Date:</strong> 
                                                <span>@accident.AccidentDate.ToString("MMM dd, yyyy")</span>
                                            </div>
                                            <div class="info-row">
                                                <strong>Location:</strong> 
                                                <span>@accident.Location</span>
                                            </div>
                                            @if (!String.IsNullOrEmpty(accident.Status))
                                            {
                                                <div class="info-row">
                                                    <strong>Repairing Status:</strong> 
                                                    <span class="status-badge danger">@accident.Status</span>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="empty-state success">
                            <i class="fas fa-shield-alt"></i>
                            <p>Great! No accidents reported</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    }

    @if (User.IsInRole("Mechanic"))
    {
        <!-- Offers Section (Mechanic Role Only) -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="profile-card">
                    <h4 class="section-title">
                        <i class="fas fa-handshake"></i>
                        My Repair Offers
                    </h4>
                    
                    @if (Model.Offers != null && Model.Offers.Any())
                    {
                        <div class="row">
                            @foreach (var offer in Model.Offers)
                            {
                                <div class="col-xl-4 col-lg-6 col-md-6 mb-3">
                                    <div class="car-card info-card">
                                        <div class="card-header">
                                            <i class="fas fa-tools"></i>
                                            <h6>Offer #@offer.OfferId</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="info-row">
                                                <strong>Car:</strong> 
                                                <span>@offer.CarName</span>
                                            </div>
                                            <div class="info-row">
                                                <strong>Price:</strong> 
                                                <span class="price">$@offer.Price.ToString("F2")</span>
                                            </div>
                                            <div class="info-row">
                                                <strong>Status:</strong> 
                                                <span class="status-badge info">@offer.Status</span>
                                            </div>
                                            <div class="info-row">
                                                <strong>Offer Date:</strong> 
                                                <span>@offer.OfferDate.ToString("MMM dd, yyyy")</span>
                                            </div>
                                            <div class="info-row">
                                                <strong>Start Date:</strong> 
                                                <span>@offer.OfferStartDate.ToString("MMM dd, yyyy")</span>
                                            </div>
                                            <div class="info-row">
                                                <strong>End Date:</strong> 
                                                <span>@offer.OfferEndDate.ToString("MMM dd, yyyy")</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>No offers submitted yet</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
    <style>
    /* Enhanced Profile View Styles */
.profile-container {
    padding: 20px;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Profile Image Styles */
.profile-image-wrapper {
    position: relative;
    display: inline-block;
}

.user-image {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #06b6d4;
    box-shadow: 0 8px 32px rgba(6, 182, 212, 0.3);
    transition: all 0.3s ease;
}

    .user-image:hover {
        transform: scale(1.05);
        box-shadow: 0 12px 40px rgba(6, 182, 212, 0.4);
    }

.image-overlay {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: #06b6d4;
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
}

    .image-overlay:hover {
        background: #0891b2;
        transform: scale(1.1);
    }

/* Card Styles */
.profile-card {
    background: white;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
}

    .profile-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }

/* Header Styles */
.profile-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.profile-title {
    color: #1e293b;
    font-weight: 700;
    margin: 0;
    font-size: 1.8rem;
}

    .profile-title i {
        color: #06b6d4;
        margin-right: 10px;
    }

.action-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* Button Styles */
.btn {
    padding: 12px 24px;
    border-radius: 10px;
    border: none;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-primary {
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    color: white;
}

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(6, 182, 212, 0.4);
        color: white;
        text-decoration: none;
    }

.btn-secondary {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

    .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        color: white;
        text-decoration: none;
    }

/* Section Title */
.section-title {
    color: #374151;
    font-weight: 600;
    margin-bottom: 20px;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 10px;
    font-size: 1.3rem;
}

    .section-title i {
        margin-right: 8px;
    }

/* Info Item Styles */
.info-item {
    padding: 15px;
    background: #f8fafc;
    border-radius: 10px;
    border-left: 4px solid #06b6d4;
    transition: all 0.3s ease;
}

    .info-item:hover {
        background: #f1f5f9;
        transform: translateX(2px);
    }

    .info-item label {
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        display: block;
        margin-bottom: 5px;
    }

    .info-item p {
        color: #1e293b;
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        word-break: break-word;
    }

/* Role Badge */
.role-badge {
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

    .role-badge.user-role {
        background: #dcfce7;
        color: #16a34a;
    }

    .role-badge.mechanic-role {
        background: #fef3c7;
        color: #d97706;
    }

/* Car Card Styles */
.car-card {
    border-radius: 12px;
    padding: 0;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid;
    height: 100%;
}

    .car-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    .car-card.success-card {
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border-color: #bbf7d0;
    }

        .car-card.success-card:hover {
            box-shadow: 0 12px 24px rgba(16, 185, 129, 0.15);
        }

    .car-card.danger-card {
        background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
        border-color: #fca5a5;
    }

        .car-card.danger-card:hover {
            box-shadow: 0 12px 24px rgba(239, 68, 68, 0.15);
        }

    .car-card.info-card {
        background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%);
        border-color: #c4b5fd;
    }

        .car-card.info-card:hover {
            box-shadow: 0 12px 24px rgba(139, 92, 246, 0.15);
        }

.card-header {
    padding: 15px 18px 10px;
    display: flex;
    align-items: center;
    gap: 10px;
}

    .card-header i {
        font-size: 18px;
    }

.success-card .card-header i {
    color: #059669;
}

.danger-card .card-header i {
    color: #dc2626;
}

.info-card .card-header i {
    color: #7c3aed;
}

.card-header h6 {
    font-weight: 700;
    margin: 0;
    font-size: 16px;
}

.success-card .card-header h6 {
    color: #065f46;
}

.danger-card .card-header h6 {
    color: #991b1b;
}

.info-card .card-header h6 {
    color: #5b21b6;
}

.card-body {
    padding: 0 18px 18px;
}

.info-row {
    margin-bottom: 8px;
    font-size: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

    .info-row strong {
        min-width: 100px;
    }

.success-card .info-row {
    color: #047857;
}

.danger-card .info-row {
    color: #b91c1c;
}

.info-card .info-row {
    color: #6d28d9;
}

.price {
    font-weight: 700;
    color: #059669 !important;
}

/* Status Badge */
.status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    color: white;
}

    .status-badge.success {
        background: #10b981;
    }

    .status-badge.danger {
        background: #dc2626;
    }

    .status-badge.info {
        background: #8b5cf6;
    }

/* Empty State */
.empty-state {
    text-align: center;
    padding: 40px;
    color: #6b7280;
}

    .empty-state i {
        font-size: 48px;
        color: #d1d5db;
        margin-bottom: 15px;
        display: block;
    }

    .empty-state.success i {
        color: #10b981;
    }

    .empty-state.success p {
        color: #10b981;
        font-weight: 600;
    }

    .empty-state p {
        font-size: 18px;
        margin: 0;
    }

</style>
</div>



