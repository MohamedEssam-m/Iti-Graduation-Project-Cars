@model List<Offer>


@inject UserManager<AppUser> userManager
<link rel="stylesheet" href="@Url.Content("~/css/Offers.css")" />
<link rel="stylesheet" href="~/css/ViewBag.css" />
<script src="~/js/ViewBag.js"></script>
@if (ViewBag.Success != null)
{
    <div class="toast-alert success-toast">
        <span>@ViewBag.Success</span>
        <button class="close-btn">&times;</button>
    </div>
}

@if (ViewBag.Error != null)
{
    <div class="toast-alert error-toast">
        <span>@ViewBag.Error</span>
        <button class="close-btn">&times;</button>
    </div>
}

<section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('/images/bg_3.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
            <div class="col-md-9 ftco-animate pb-5">
                <p class="breadcrumbs">
                    <span class="mr-2">
                        <a href="/">Home <i class="ion-ios-arrow-forward"></i></a>
                    </span> 
                    <span>Offers <i class="ion-ios-arrow-forward"></i></span>
                </p>
                <h1 class="mb-3 bread">Offers</h1>
            </div>
        </div>
    </div>
</section>

@if (Model == null || Model.Count == 0)
{
    <div class="no-offers-message">
        <h2>No Offers Available</h2>
        <p>There are currently no offers available for this accident.</p>
    </div>
}
else
{
    <div class="offers-container">
        @foreach (var offer in Model)
        {
            @if(offer.Status != "Declined" && offer.Status != "Paid" && User.Identity.IsAuthenticated)
            {
                <div class="offer-card">
                    <div class="offer-content">
                        <div class="offer-price">
                            @offer.Price.ToString("C")
                        </div>
                        
                        <div class="offer-info">
                            <div class="info-item">
                                <span class="info-label">Description:</span>
                                <span class="info-value">@offer.Details</span>
                            </div>
                            
                            <div class="info-item">
                                <span class="info-label">Car:</span>
                                <span class="info-value">@offer.CarName</span>
                            </div>
                            
                            <div class="info-item">
                                <span class="info-label">Mechanic:</span>
                                <span class="info-value mechanic-value">@offer.Mechanic?.UserName</span>
                            </div>
                            
                            <div class="info-item">
                                <span class="info-label">Offer Date:</span>
                                <span class="info-value date-value">@offer.OfferDate.ToString("MMM dd, yyyy")</span>
                            </div>
                            
                            <div class="info-item">
                                <span class="info-label">Repair Start:</span>
                                <span class="info-value date-value">@offer.OfferStartDate.ToString("MMM dd, yyyy")</span>
                            </div>
                            
                            <div class="info-item">
                                <span class="info-label">Car Delivery:</span>
                                <span class="info-value date-value">@offer.OfferEndDate.ToString("MMM dd, yyyy")</span>
                            </div>
                        </div>

                        @if(User.IsInRole("User") && userManager.GetUserId(User) == ViewBag.USERID && offer.Status == "Pending")
                        {
                            <div class="car-buttons">
                                <!-- Accept Offer -->
                                <form asp-controller="Offer" asp-action="Accept" method="post">
                                    <button type="submit" name="id" value="@offer.OfferId" class="accept-button">
                                        Accept Offer
                                    </button>
                                </form>

                                <!-- Decline Offer -->
                                <form asp-controller="Offer" asp-action="Decline" method="post">
                                    <button type="submit" name="id" value="@offer.OfferId" class="decline-button">
                                        Decline Offer
                                    </button>
                                </form>
                            </div>
                        }
                        @if(User.IsInRole("Mechanic") && userManager.GetUserId(User) == offer.MechanicId && offer.Status == "Pending")
                        {
                            <div class="car-buttons">
                                <!-- Edit Offer -->
                                <form asp-controller="Offer" asp-action="EditOfferView" method="get">
                                    <button type="submit" name="offerId" value="@offer.OfferId" class="accept-button">
                                        Edit Offer
                                    </button>
                                </form>

                                <!-- Delete Offer -->
                                <form asp-controller="Offer" asp-action="DeleteOfferView" method="get">
                                    <button type="submit" name="offerId" value="@offer.OfferId" class="decline-button">
                                        Delete Offer
                                    </button>
                                </form>
                            </div>
                        }
                        
                        @if(offer.Status == "Paid")
                        {
                            <div class="deal-done">
                                <span>✓</span>
                                <span>Deal Completed</span>
                            </div>
                        }
                    </div>
                </div>
            }
        }
    </div>
}
