@model Car
@{
    Layout = "~/Views/Shared/_Layout.cshtml";  
}
<link rel="stylesheet" href="~/css/CarDetails.css" />
<link rel="stylesheet" href="~/css/Rate.css" />
<link rel="stylesheet" href="~/css/ViewBag.css" />
<script src="~/js/ViewBag.js"></script>
@if (ViewBag.Success != null)
{
    <div class="toast-alert success-toast">
        <span>@ViewBag.Success</span>
        <button class="close-btn">&times;</button>
    </div>
}

@if (ViewBag.Error != null)
{
    <div class="toast-alert error-toast">
        <span>@ViewBag.Error</span>
        <button class="close-btn">&times;</button>
    </div>
}

<section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('/images/bg_3.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
            <div class="col-md-9 ftco-animate pb-5">
                <p class="breadcrumbs">
                    <span class="mr-2">
                        <a href="@Url.Action("Index", "Home")">@SharedLocalizer["Home"] <i class="ion-ios-arrow-forward"></i></a>
                    </span> 
                    <span>Roles <i class="ion-ios-arrow-forward"></i></span>
                </p>
                <h1 class="mb-3 bread">Car Details</h1>
            </div>
        </div>
    </div>
</section>

<section class="car-details-container">
    <div class="car-details-card">
        <div class="car-image" style="background-image: url('/Files/@Model.CarImagePath');"></div>
        <h2>@Model.Brand @Model.Model (@Model.Year)</h2>
        
        <div class="details-section">
            <h3>General Info</h3>
            <div class="details-grid">
                <div><strong>Body Type:</strong> @Model.BodyType</div>
                <div><strong>Doors:</strong> @Model.Doors</div>
                <div><strong>Fuel Type:</strong> @Model.FuelType</div>
                <div><strong>Engine Capacity:</strong> @Model.EngineCapacity CC</div>
                <div><strong>Horse Power:</strong> @Model.HorsePower HP</div>
                <div><strong>Fuel Consumption:</strong> @Model.FuelConsumption Km/L</div>
                <div><strong>Seats:</strong> @Model.Seats</div>
                <div><strong>Transmission:</strong> @Model.Transmission</div>
                <div><strong>Luggage Capacity:</strong> @Model.LuggageCapacity L</div>
                <div><strong>Price/Day:</strong> @Model.PricePerDay EGP</div>
                <div><strong>Max KM/Day:</strong> @Model.MaxKmPerDay</div>
                <div><strong>Quantity:</strong> @Model.quantity</div>
                <div><strong>Status:</strong> @Model.Status</div>
                <div><strong>Insurance Included:</strong> @(Model.InsuranceIncluded ? "Yes" : "No")</div>
            </div>
        </div>
        <div class="details-section">
            <h3>Comfort</h3>
            <div class="details-grid">
                <div><strong>Air Condition:</strong> @(Model.HasAirCondition ? "Yes" : "No")</div>
            </div>
        </div>
        <div class="details-section">
            <h3>Entertainment</h3>
            <div class="details-grid">
                <div><strong>Multimedia:</strong> @(Model.HasMultimedia ? "Yes" : "No")</div>
            </div>
        </div>
        <div class="details-section">
            <h3>Safety</h3>
            <div class="details-grid">
                <div><strong>Airbags:</strong> @(Model.HasAirbags ? "Yes" : "No")</div>
                <div><strong>ABS:</strong> @(Model.HasABS ? "Yes" : "No")</div>
                <div><strong>ESP:</strong> @(Model.HasESP ? "Yes" : "No")</div>
                <div><strong>Rear Camera:</strong> @(Model.HasRearCamera ? "Yes" : "No")</div>
                <div><strong>Parking Sensors:</strong> @(Model.HasParkingSensors ? "Yes" : "No")</div>
            </div>
        </div>
        <div class="details-section">
            <h3>Average Rate</h3>
            <div class="details-grid">
                <div><strong>Rate: @Model.AverageRating</div>
            </div>
        </div>
        
        <!-- Rate Car Button -->
        <div class="rate-car-btn" style="margin-top:20px; text-align:right;">
            <button id="openRatingModal" class="btn btn-primary">
                Rate Car
            </button>
        </div>
        <div class="rate-car-btn" style="margin-top:20px; text-align:right;">
            <form asp-action="ViewRatings" asp-controller="Cars" method="get" class="registration-form">
                <button type="submit" name="CarId" value="@Model.CarId" id="openRatingModal" class="btn btn-primary">
                    View Rates
                </button>
            </form>
            
        </div>
        <!-- Back Button -->
        <div class="rate-car-btn" style="margin-top:20px; text-align:right;">
            <form asp-action="Cars" asp-controller="Home" method="get" class="registration-form">
                <button type="submit" id="openRatingModal" class="btn btn-primary">
                    Back
                </button>
            </form>
            
        </div>
    </div>
</section>

<!-- Rating Modal -->
<div id="ratingModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Rate This Car</h2>
        
        <form id="ratingForm" method="post" asp-action="SaveCareRate" asp-controller="Cars">
            <input type="hidden" name="CarId" value="@Model.CarId" />
            <div class="rating-section">
                <h4>How would you rate this car?</h4>
                <!-- From Uiverse.io by LeonKohli -->
                <div class="radio">
                    <input id="rating-5" type="radio" name="Rating" value="5" />
                    <label for="rating-5" title="5 stars">
                        <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                        </svg>
                    </label>
                    <input id="rating-4" type="radio" name="Rating" value="4" />
                    <label for="rating-4" title="4 stars">
                        <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                        </svg>
                    </label>
                    <input id="rating-3" type="radio" name="Rating" value="3" />
                    <label for="rating-3" title="3 stars">
                        <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                        </svg>
                    </label>
                    <input id="rating-2" type="radio" name="Rating" value="2" />
                    <label for="rating-2" title="2 stars">
                        <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                        </svg>
                    </label>
                    <input id="rating-1" type="radio" name="Rating" value="1" />
                    <label for="rating-1" title="1 star">
                        <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                        </svg>
                    </label>
                </div>
            </div>
            
            <div class="comment-section">
                <h4>Share your experience (Optional)</h4>
                <textarea name="Comment" placeholder="Tell us about your experience with this car..." maxlength="500"></textarea>
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="modal-btn cancel-btn" id="cancelRating">Cancel</button>
                <button type="submit" class="modal-btn submit-btn">Submit Rating</button>
            </div>
        </form>
    </div>
</div>

<script>
// Modal functionality
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('ratingModal');
    const openBtn = document.getElementById('openRatingModal');
    const closeBtn = document.querySelector('.close');
    const cancelBtn = document.getElementById('cancelRating');
    const form = document.getElementById('ratingForm');

    // Open modal
    openBtn.addEventListener('click', function() {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
    });

    // Close modal function
    function closeModal() {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Restore scrolling
        form.reset(); // Reset form
    }

    // Close modal events
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);

    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            closeModal();
        }
    });

    // Form validation
    form.addEventListener('submit', function(e) {
        const ratingSelected = document.querySelector('input[name="Rating"]:checked');
        
        if (!ratingSelected) {
            e.preventDefault();
            alert('Please select a rating before submitting.');
            return false;
        }
        
        // Optional: Add loading state
        const submitBtn = form.querySelector('.submit-btn');
        submitBtn.textContent = 'Submitting...';
        submitBtn.disabled = true;
    });

    // Keyboard support
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.style.display === 'block') {
            closeModal();
        }
    });
});
</script>