@{
    var returnUrl = Context.Request.Path + Context.Request.QueryString;
}
@inject IAppUserService userService;
@inject UserManager<AppUser> userManager;
@{
    var userId = userManager.GetUserId(User);
    var user = await userService.GetById(userId);
}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MotoCar 🏎️</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/button.css">
    <link rel="stylesheet" href="~/css/rolestyle.css">
    <link rel="stylesheet" href="~/css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="~/css/animate.css">
    
    <link rel="stylesheet" href="~/css/owl.carousel.min.css">
    <link rel="stylesheet" href="~/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="~/css/magnific-popup.css">

    <link rel="stylesheet" href="~/css/aos.css">

    <link rel="stylesheet" href="~/css/ionicons.min.css">

    <link rel="stylesheet" href="~/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="~/css/jquery.timepicker.css">

    
    <link rel="stylesheet" href="~/css/flaticon.css">
    <link rel="stylesheet" href="~/css/icomoon.css">
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/AI.css">
  </head>
  <body>
    
	  <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
    <div class="container">
        @if(User.Identity.IsAuthenticated)
            {
                <p id="usernameBtn" 
   onclick="showPopup()" 
   style="
       color: #06b6d4;
       font-weight: 600;
       font-size: 16px;
       cursor: pointer;
       text-decoration: none;
       padding: 12px 20px;
       background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);
       border: 2px solid transparent;
       border-radius: 25px;
       display: inline-block;
       margin: 10px 15px; 
       box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15); 
       transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
       position: relative;

       min-width: 125px;       
       max-width: 200px;       
       white-space: nowrap;    
       overflow: hidden;       
       text-overflow: ellipsis;
   "
   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(6, 182, 212, 0.25)'; this.style.borderColor='#06b6d4';"
   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(6, 182, 212, 0.15)'; this.style.borderColor='transparent';"
   onmousedown="this.style.transform='translateY(0) scale(0.98)';"
   onmouseup="this.style.transform='translateY(-2px) scale(1)';">
    Hello @user.UserName
</p>


    <!-- Popup Overlay -->
    <div id="popupOverlay" 
         style="
             display: none;
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background-color: rgba(0, 0, 0, 0.5);
             z-index: 999;
             opacity: 0;
             transition: opacity 0.3s ease-in-out;
         "
         onclick="hidePopup()">
    </div>

    <!-- Popup Menu -->
    <div id="popupMenu" 
         style="
             display: none;
             position: fixed;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%) scale(0.9);
             background: white;
             border-radius: 16px;
             box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
             z-index: 1000;
             padding: 20px;
             width: 300px;
             transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
             opacity: 0;
         ">
        
        <!-- Popup Header -->
        <div style="
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        ">
            <h3 style="
                margin: 0;
                color: #06b6d4;
                font-size: 20px;
                font-weight: 700;
            ">User Menu</h3>
        </div>

        <!-- Menu Buttons -->
        <div style="display: flex; flex-direction: column; gap: 12px;">
            
            <!-- Edit Profile Button    controller     action-->    
            <button onclick="navigateToPage('Profile', 'ProfileView')" 
                    style="
                        background: linear-gradient(135deg, #f0f9ff 0%, #e0f7fa 100%);
                        color: #0891b2;
                        border: 2px solid transparent;
                        padding: 14px 20px;
                        border-radius: 12px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        text-align: left;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    "
                    onmouseover="this.style.borderColor='#0891b2'; this.style.transform='translateX(4px)';"
                    onmouseout="this.style.borderColor='transparent'; this.style.transform='translateX(0)';">
                <span style="font-size: 20px;">👤</span>
                View Profile
            </button>

            @* <!-- Change Password Button -->
            <button onclick="navigateToPage('#', '#')" 
                    style="
                        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                        color: #d97706;
                        border: 2px solid transparent;
                        padding: 14px 20px;
                        border-radius: 12px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        text-align: left;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    "
                    onmouseover="this.style.borderColor='#d97706'; this.style.transform='translateX(4px)';"
                    onmouseout="this.style.borderColor='transparent'; this.style.transform='translateX(0)';">
                <span style="font-size: 20px;">🔐</span>
                Change Password
            </button>

            <!-- Show My Cars Button -->
            <button onclick="navigateToPage('#', '#')" 
                    style="
                        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
                        color: #16a34a;
                        border: 2px solid transparent;
                        padding: 14px 20px;
                        border-radius: 12px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        text-align: left;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    "
                    onmouseover="this.style.borderColor='#16a34a'; this.style.transform='translateX(4px)';"
                    onmouseout="this.style.borderColor='transparent'; this.style.transform='translateX(0)';">
                <span style="font-size: 20px;">🚗</span>
                Show My Cars
            </button>

            <!-- Show My Accidents Button -->
            <button onclick="navigateToPage('#', '#')" 
                    style="
                        background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
                        color: #dc2626;
                        border: 2px solid transparent;
                        padding: 14px 20px;
                        border-radius: 12px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        text-align: left;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    "
                    onmouseover="this.style.borderColor='#dc2626'; this.style.transform='translateX(4px)';"
                    onmouseout="this.style.borderColor='transparent'; this.style.transform='translateX(0)';">
                <span style="font-size: 20px;">⚠️</span>
                Show My Accidents
            </button> *@

        </div>

        <!-- Close Button -->
        <button onclick="hidePopup()" 
                style="
                    background: #f3f4f6;
                    color: #6b7280;
                    border: none;
                    padding: 12px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: 600;
                    width: 100%;
                    margin-top: 15px;
                    transition: all 0.3s ease;
                "
                onmouseover="this.style.background='#e5e7eb';"
                onmouseout="this.style.background='#f3f4f6';">
            Close
        </button>
    </div>

    <script>
        function showPopup() {
            const overlay = document.getElementById('popupOverlay');
            const popup = document.getElementById('popupMenu');
            
            overlay.style.display = 'block';
            popup.style.display = 'block';
            
            // Trigger animations
            setTimeout(() => {
                overlay.style.opacity = '1';
                popup.style.opacity = '1';
                popup.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 10);
        }

        function hidePopup() {
            const overlay = document.getElementById('popupOverlay');
            const popup = document.getElementById('popupMenu');
            
            overlay.style.opacity = '0';
            popup.style.opacity = '0';
            popup.style.transform = 'translate(-50%, -50%) scale(0.9)';
            
            setTimeout(() => {
                overlay.style.display = 'none';
                popup.style.display = 'none';
            }, 300);
        }

        function navigateToPage(controller, action) {
            // Replace # with your actual controller and action
            const url = `/${controller}/${action}`;
            window.location.href = url;
        }

        // Close popup when pressing Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                hidePopup();
            }
        });
    </script>
            }

        <a class="navbar-brand" asp-controller="Home" asp-action="Index">Car<span>Book</span></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
                aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="oi oi-menu"></span> Menu
        </button>

        <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav ms-auto align-items-center">

                <li class="nav-item @(ViewData["ActivePage"] as string == "Home" ? "active" : "")">
                    <a class="nav-link" asp-controller="Home" asp-action="Index">Home</a>
                </li>
                <li class="nav-item @(ViewData["ActivePage"] as string == "About" ? "active" : "")">
                    <a class="nav-link" asp-controller="Home" asp-action="About">About</a>
                </li>
                <li class="nav-item @(ViewData["ActivePage"] as string == "Services" ? "active" : "")">
                    <a class="nav-link" asp-controller="Home" asp-action="Services">Services</a>
                </li>
                <li class="nav-item @(ViewData["ActivePage"] as string == "Cars" ? "active" : "")">
                    <a class="nav-link" asp-controller="Home" asp-action="Cars">Cars</a>
                </li>
                @if(User.IsInRole("Admin"))
                    {
                            <li class="nav-item @(ViewData["ActivePage"] as string == "AdminPanel" ? "active" : "")">
                                <a class="nav-link" asp-controller="Home" asp-action="AdminPanel">AdminPanel</a>
                            </li>
                    }
@*                     @if (User.Identity.IsAuthenticated)
                    { 
                    <li class="nav-item dropdown @(ViewData["ActivePage"] as string == "ManageProfile" ? "active" : "")">
    <a class="nav-link dropdown-toggle text-white" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fa fa-user-circle me-1"></i> Profile
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
        <li>
            <a class="dropdown-item" asp-controller="EditUserProfile" asp-action="EditUserProfileView">
                <i class="fa fa-user-edit me-2"></i> Edit Personal Info
            </a>
        </li>
        <li>
            <a class="dropdown-item" asp-controller="EditUserProfile" asp-action="VerifyEmail">
                <i class="fa fa-key me-2"></i> Change Password
            </a>
        </li>
    </ul>
</li>
} *@
                <li class="nav-item @(ViewData["ActivePage"] as string == "Repair" ? "active" : "")">
                    <a class="nav-link" asp-controller="Accident" asp-action="Repair">Repair</a>
                </li>

                <li class="nav-item @(ViewData["ActivePage"] as string == "Contact" ? "active" : "")">
                    <a class="nav-link" asp-controller="Home" asp-action="Contact">Contact</a>
                </li>

               


<!-- Auth Buttons -->
@if(!User.Identity.IsAuthenticated)
                    {
                        <li class="nav-item ms-auto d-flex align-items-center auth-buttons">
                            <a class="btn btn-outline-light btn-sm auth-btn" asp-controller="Account" asp-action="determineRole">
                                <i class="fa fa-user-plus me-1"></i> Sign Up
                            </a>

                            <a class="btn btn-outline-light btn-sm auth-btn" asp-controller="Account" asp-action="LoginView">
                                <i class="fa fa-sign-in me-1"></i> Sign In
                            </a>
                        </li>
                    }
                    
@if(User.Identity.IsAuthenticated)
{
    <li class="nav-item ms-auto d-flex align-items-center auth-buttons">
        <a class="btn btn-outline-light btn-sm auth-btn" asp-controller="Account" asp-action="LogOutView">
            <i class="fa fa-sign-out me-1"></i> Log Out
        </a>
    </li>
}

<style>
    .auth-buttons {
        gap: 12px; 
        margin-left: auto; 
    }

    .auth-buttons .auth-btn {
        border-color: #fff;
        color: #fff;
        transition: all 0.3s ease-in-out;
        position: relative;
    }

    
    .auth-buttons .auth-btn:not(:last-child)::after {
        content: "";
        position: absolute;
        right: -8px;
        top: 25%;
        height: 50%;
        width: 1px;
        background-color: rgba(255, 255, 255, 0.4);
    }

    .auth-buttons .auth-btn:hover {
        background-color: #06b6d4; 
        border-color: #06b6d4;
        color: #fff;
        transform: scale(1.05);
    }
    /* From Uiverse.io by TroyRandall */ 
.edit-post {
  position: relative;
  background: #ffffff;
  color: #000;
  padding: 15px;
  margin: 10px;
  border-radius: 10px;
  width: 40px;
  height: 40px;
  font-size: 17px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  box-shadow: 0 10px 10px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.edit-tooltip {
  position: absolute;
  top: 0px;
  font-size: 14px;
  background: #ffffff;
  color: #ffffff;
  padding: 5px 8px;
  border-radius: 5px;
  box-shadow: 0 10px 10px rgba(0, 0, 0, 0.1);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  width: 150px;
}

.edit-tooltip::before {
  position: absolute;
  content: "";
  height: 8px;
  width: 8px;
  background: #ffffff;
  bottom: -3px;
  left: 50%;
  transform: translate(-50%) rotate(45deg);
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.edit-post:hover .edit-tooltip {
  top: -45px;
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

.edit-icon {
  font-size: 24px;
}

.edit-post:hover,
.edit-post:hover .edit-tooltip,
.edit-post:hover .edit-tooltip::before {
  background: linear-gradient(320deg, rgb(3, 255, 255), rgb(0, 255, 255));
  color: #ffffff;
}
    body.dark-mode {
        background-color: #121212;
        color: #e0e0e0;
    }

    body.dark-mode .navbar {
        background-color: #1f1f1f !important;
    }

    body.dark-mode .dropdown-menu {
        background-color: #2c2c2c;
        color: #fff;
    }

    body.dark-mode .dropdown-item {
        color: #fff;
    }

    body.dark-mode .dropdown-item:hover {
        background-color: #06b6d4;
        color: #fff;
    }
</style>
<!-- Dark Mode Script -->
<script>
    function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("dark-mode", document.body.classList.contains("dark-mode"));
    }

    // Load saved preference
    window.onload = function () {
        if (localStorage.getItem("dark-mode") === "true") {
            document.body.classList.add("dark-mode");
        }
    }
</script>


                 <!-- Language Toggle -->
<!-- Settings Button with Dropdown -->
<li class="nav-item dropdown ms-3">
    <div class="edit-post dropdown-toggle" id="settingsDropdown" data-bs-toggle="dropdown" aria-expanded="true" style="cursor:pointer;">
        <span class="edit-tooltip">Settings</span>
        <span class="edit-icon">⚙️</span>
    </div>

    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="settingsDropdown">
        <!-- Localization Toggle -->
        <li>
            @if (System.Threading.Thread.CurrentThread.CurrentCulture.Name == "ar-EG")
            {
                <a class="dropdown-item d-flex align-items-center" href="@Url.Action("SetLanguage", "Language", new { culture = "en-US", returnUrl = Context.Request.Path + Context.Request.QueryString })">
                    <img src="~/lib/famfamfam-flags/dist/png/us.png" width="22" height="14" class="me-2" /> English
                </a>
            }
            else
            {
                <a class="dropdown-item d-flex align-items-center" href="@Url.Action("SetLanguage", "Language", new { culture = "ar-EG", returnUrl = Context.Request.Path + Context.Request.QueryString })">
                    <img src="~/lib/famfamfam-flags/dist/png/eg.png" width="22" height="14" class="me-2" /> العربية
                </a>
            }
        </li>

        <li><hr class="dropdown-divider"></li>

        
    </ul>
</li>
<!-- Add this link anywhere in your layout or view -->
<div class="ai-assistant-link-container">
    <a href="@Url.Action("Index", "Gemini")" 
       class="ai-assistant-link" 
       style="padding:6px 12px; min-width:120px; border-radius:8px; font-size:12px;">
        <div class="link-background"></div>
        <div class="link-content" style="gap:8px;">
            <div class="ai-icon" style="width:22px; height:22px;">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width:12px; height:12px;">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" 
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="pulse-ring" style="width:22px; height:22px; border-radius:6px;"></div>
                <div class="pulse-ring-2" style="width:22px; height:22px; border-radius:6px;"></div>
            </div>
            <div class="link-text">
                <span class="main-text" style="font-size:12px;">AI Assistant</span>
                <span class="sub-text" style="font-size:10px;">Chat with AI</span>
            </div>
            <div class="arrow-icon" style="width:12px; height:12px;">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 12h14M12 5l7 7-7 7" 
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
        <div class="hover-overlay"></div>
    </a>
</div>



<style>
    .lang-toggle {
        background: white;
        color: #06b6d4; /* cyan */
        border: 2px solid #06b6d4;
        font-weight: 600;
        border-radius: 20px;
        padding: 4px 12px;
        transition: all 0.3s ease-in-out;
    }

    .lang-toggle:hover {
        background: #06b6d4;
        color: white;
        text-decoration: none;
        transform: scale(1.05);
    }

    .lang-toggle img {
        border-radius: 2px;
    }
</style>
                
                    
            </ul>
        </div>
    </div>
</nav>
 @RenderBody()
    <footer class="ftco-footer ftco-bg-dark ftco-section">
      <div class="container">
        <div class="row mb-5">
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2"><a href="#" class="logo">Car<span>book</span></a></h2>
              <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
              <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
                <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4 ml-md-5">
              <h2 class="ftco-heading-2">Information</h2>
              <ul class="list-unstyled">
                <li><a href="#" class="py-2 d-block">About</a></li>
                <li><a href="#" class="py-2 d-block">Services</a></li>
                <li><a href="#" class="py-2 d-block">Term and Conditions</a></li>
                <li><a href="#" class="py-2 d-block">Best Price Guarantee</a></li>
                <li><a href="#" class="py-2 d-block">Privacy &amp; Cookies Policy</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
             <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Customer Support</h2>
              <ul class="list-unstyled">
                <li><a href="#" class="py-2 d-block">FAQ</a></li>
                <li><a href="#" class="py-2 d-block">Payment Option</a></li>
                <li><a href="#" class="py-2 d-block">Booking Tips</a></li>
                <li><a href="#" class="py-2 d-block">How it works</a></li>
                <li><a href="#" class="py-2 d-block">Contact Us</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
            	<h2 class="ftco-heading-2">Have a Questions?</h2>
            	<div class="block-23 mb-3">
	              <ul>
	                <li><span class="icon icon-map-marker"></span><span class="text">203 Fake St. Mountain View, San Francisco, California, USA</span></li>
	                <li><a href="#"><span class="icon icon-phone"></span><span class="text">+2 392 3929 210</span></a></li>
	                <li><a href="#"><span class="icon icon-envelope"></span><span class="text">info@yourdomain.com</span></a></li>
	              </ul>
	            </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 text-center">

            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart color-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          </div>
        </div>
      </div>
    </footer>
    
  

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="~/js/jquery.min.js"></script>
  <script src="~/js/jquery-migrate-3.0.1.min.js"></script>
  <script src="~/js/popper.min.js"></script>
  <script src="~/js/bootstrap.min.js"></script>
  <script src="~/js/jquery.easing.1.3.js"></script>
  <script src="~/js/jquery.waypoints.min.js"></script>
  <script src="~/js/jquery.stellar.min.js"></script>
  <script src="~/js/owl.carousel.min.js"></script>
  <script src="~/js/jquery.magnific-popup.min.js"></script>
  <script src="~/js/aos.js"></script>
  <script src="~/js/jquery.animateNumber.min.js"></script>
  <script src="~/js/bootstrap-datepicker.js"></script>
  <script src="~/js/jquery.timepicker.min.js"></script>
  <script src="~/js/scrollax.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="~/js/google-map.js"></script>
  <script src="~/js/main.js"></script>
    
  </body>
</html>